.controls
  - if current_user == @question.author
    = link_to "Edit", edit_question_path
%h2=h @question.title

= render :partial => 'votes/form', :locals => { :voteable => @question, :parent => nil }

%p=h @question.body

.clear

%p.meta
  Asked by
  = author_link @question
  = time_ago_in_words @question.created_at
  ago

%h3= pluralize(@question.answers.count, 'answer')

%ul.answers
  - @question.answers.each do |answer|
    %li.answer{:class => answer.accepted? ? "accepted" : "not_accepted"}
      = render :partial => 'votes/form', :locals => { :voteable => answer, :parent => @question }
      .controls
        - if current_user == @question.author
          - if !answer.accepted?
            - form_for @question do |f|
              = hidden_field_tag 'question[accepted_answer_id]', answer.id
              = f.submit "Accept"
          - elsif answer.accepted?
            - form_for @question do |f|
              = hidden_field_tag 'question[accepted_answer_id]', nil
              = f.submit "Unaccept"

      %p=h answer.body
      .clear

      %p.meta
        Answered by
        = author_link answer
        = time_ago_in_words answer.created_at
        ago
      -if answer.accepted?
        %p.meta
          This answer has been accepted by the question asker
          = "(#{author_link @question})"

%h2 Answer this question

- form_for [@question, @answer] do |f|
  = f.error_messages
  = f.text_area :body, :rows => 5
  = f.submit "Post answer"
